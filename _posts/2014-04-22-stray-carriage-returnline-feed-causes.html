---
layout: post
title: Stray carriage return/line feed causes hotmail to mangle hyperlink
date: '2014-04-22T06:47:00.000-07:00'
author: Luke Briner
tags:
- email
- "%20%20"
- HTML emails
- duplicate
- Hotmail
- HTTPS
- mangled
- link
- broken
- links
modified_time: '2014-04-22T06:47:06.119-07:00'
---

Headline: Don't put carriage return/linefeeds/newlines in your href attributes!<br /><br /><h3>The Details</h3><br />Our system sends out HTML emails to users with a few images and some links. Image my surprise when one of these emails had a link that appeared to be broken by Hotmail and no obvious Google search results as to what had happened.<br /><br />The test link in the email was sent as <b>href='https://127.0.0.1:446/something'</b> and this was also the display text. When the email arrived, it looked like this:<br /><br /><br /><img alt="" src="data:image/png;base64,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" /><br />But when hovering over the link, the status bar showed: <b>https://%20%20https://127.0.0.1:446/something</b> which naturally was a broken link. The %20 is a space character encoded, which was strange, especially as the display text looked correct but on closer examination of the email source, I noticed a lot of =0D=0A sequences, which are encoded carriage return/line feed pairs. I expected a few of these since the HTML is built up in code using a StringBuilder and various calls to Append and AppendLine but it then became apparent that we were using AppendLine while generating each part of this email link, which produced something like:<br /><br />&lt;a href='<br />https://127.0.0.1:446/something<br />?querystring<br />'&gt;<br />https://127.0.0.1:446/something<br />?querystring<br />&lt;/a&gt;<br /><br />Which is possibly illegal HTML, certainly unusual. Since CR/LF are ignored in display text in HTML, the text was displayed correctly but the whitespace in the href attribute obviously confused something and made the link get mangled.<br /><br />The moral? Generate your links properly!