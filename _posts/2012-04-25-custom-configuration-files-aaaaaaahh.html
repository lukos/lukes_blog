---
layout: post
title: Custom Configuration Files aaaaaaahh
date: '2012-04-25T05:40:00.001-07:00'
author: Luke Briner
tags:
- asp.net
- errors
- configuration
modified_time: '2012-04-27T07:59:01.009-07:00'
---

If anyone has done this, you might have come across all sorts of pain. I was trying to do a basic custom configuration like this:<br /><pre>&lt;sessioncomparersection&gt;<br />&nbsp; &nbsp;&lt;environments&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;add connstring="blah" displayname="blah"&gt;&lt;/add&gt;<br />&nbsp; &nbsp;&lt;/environments&gt;<br />&lt;/sessioncomparersection&gt;<br /></pre>I started with a simple configuration section with a single property like this and it all worked fine:<br /><pre><br />&lt;sessioncomparersection environments="test"&gt;<br />&lt;/sessioncomparersection&gt;<br /></pre>I then added the <span style="font-family: 'Courier New', Courier, monospace;">ConfigurationElementCollection</span> derived class for the list of environments and created a specialised <span style="font-family: 'Courier New', Courier, monospace;">ConfigurationElement</span><span style="font-family: Times, 'Times New Roman', serif;"> class for the 'add' data in the collection exactly as per the examples I found on the web. Sadly, I then started getting&nbsp;</span><span style="background-color: white; font-size: 14px; line-height: 18px; text-align: left;"><span style="font-family: 'Courier New', Courier, monospace;">ConfigurationErrorsException</span><span style="font-family: Times, 'Times New Roman', serif;"> "unrecognized element 'environments'" when it tried to load the configuration.&nbsp;</span></span><span style="background-color: white; font-family: Times, 'Times New Roman', serif; font-size: 14px; line-height: 18px; text-align: left;">Sadly this is caused by many things, none of which helped me.</span><br /><span style="font-family: Times, 'Times New Roman', serif; font-size: 14px; line-height: 18px; text-align: left;">On a whim, I removed the </span><span style="font-family: 'Courier New', Courier, monospace; font-size: 14px; line-height: 18px; text-align: left;">ConfigurationPropertyCollection </span><span style="font-family: Times, 'Times New Roman', serif; font-size: 14px; line-height: 18px; text-align: left;">from the top level section (which was now empty but which was returned by an override method in my&nbsp;</span><span style="font-family: 'Courier New', Courier, monospace; font-size: 14px; line-height: 18px; text-align: left;">ConfigurationSection </span><span style="font-family: Times, 'Times New Roman', serif; font-size: 14px; line-height: 18px; text-align: left;">top level class) and this made it all work again!</span><br /><span style="font-family: Times, 'Times New Roman', serif; font-size: 14px; line-height: 18px; text-align: left;">I guess if you need the collection at the top level, you need to add a reference to the collection property (Environments in my case) into the property collection so it knows that it is present. This is despite the fact I had marked it up with </span><span style="font-family: 'Courier New', Courier, monospace; font-size: 14px; line-height: 18px; text-align: left;">ConfigurationProperty</span><span style="font-family: Times, 'Times New Roman', serif; font-size: 14px; line-height: 18px; text-align: left;">.</span><br /><br />