---
layout: post
title: Adding sub-sites in IIS7
date: '2012-09-20T02:26:00.000-07:00'
author: Luke Briner
tags:
- virtual directories
- IIS7
- web.config
modified_time: '2012-09-20T02:26:29.357-07:00'
---

The title reflects my limited understanding of what I was trying to do in IIS7. I had a web site which was under a domain name which needed to access a web service hosted on the same machine. Since I wanted to use ssl for both and I had a certificate for the top level site, I wanted to host the web service under the other site somehow.<br />I tried adding it as an application under the main site and pointed to the relevant directory and after the usual fun and games (usually needing to add permissions for <machine_name>\iis_iusrs and iusr to the relevant directories) I was still getting errors and it took a while to spot that the complaint was "assembly X could not be found". What I eventually noticed was that assembly X was referenced by the top level site so why was my web service attempting to load it? It didn't take long to realize that the web service was inheriting the web config of its parent application even though it was in a physically separate directory. I then found good old Rick Strahls blog post here:&nbsp;<a href="http://www.west-wind.com/weblog/posts/2007/Aug/11/IISASPNET-Settings-and-Virtual-Directory-Inheritance">http://www.west-wind.com/weblog/posts/2007/Aug/11/IISASPNET-Settings-and-Virtual-Directory-Inheritance</a>&nbsp;w<span style="font-family: inherit;">hich identified the workaround as adding a <location nbsp="nbsp" span="span" style="border: 0px; line-height: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;"><span style="border: 0px; line-height: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;"> </span><span style="border: 0px; line-height: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">inheritInChildApplications</span><span style="border: 0px; line-height: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">=</span>"<span style="border: 0px; line-height: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">false</span>"</location></span></machine_name><br />&gt; tag around system.web and system.webserver elements in the parent site's web config.This indeed stops the inheritance but then I had a follow-on problem with a 500.22 error which detects an invalid config setting for integrated pipeline mode. This is a strange error since all I added was a (valid) location tag but then found another post here:&nbsp;<a href="http://runtingsproper.blogspot.co.uk/2010/04/solved-iis7-validateintegratedmodeconfi.html">http://runtingsproper.blogspot.co.uk/2010/04/solved-iis7-validateintegratedmodeconfi.html</a>&nbsp;which describes the workaround as removing any httphandlers from the system.web section. I don't know why this only happens with the location tag, perhaps the invalid code is ignored if the config is inherited (since it might be inherited into a classic application pool?) but anyway, in my case, I didn't need the module so I simply removed it and the site came back to life.