---
layout: post
title: Creating a REST web service using Yii and PHP
date: '2013-04-11T08:53:00.000-07:00'
author: Luke Briner
tags:
- Yii
- rest
- restful service
- php
modified_time: '2013-04-11T08:53:38.286-07:00'
---

This is the flavour of the month for budding web developers! Developing REST is pretty easy actually for two reasons. Firstly, a REST web service is actually only a web application since web applications already support most of what you want to call your web service with. The only things that might help are an MVC framework which allow you to abstract between the url that is called from the outside and the controller that handles the action. Secondly, REST uses standard HTTP syntax which is as old and well supported as the hills!<br /><br />For instance, a common pattern is http://<myhost>/api/model/action (although the action is sometimes inferred from the HTTP verb (like GET, POST, DELETE etc.). This might mean you have something like /api/user/put, /api/user/delete, /api/user/get which in traditional web development would point to three different directories/files but which you probably want to point to the same controller, say a UserController!</myhost><br /><br />Anyway, in Yii it's really easy. There is a longer example <a href="http://www.yiiframework.com/wiki/175/how-to-create-a-rest-api/" target="_blank">here </a>but I will just cover the outline:<br /><br /><ol><li>Download Yii as normal, you may or may not want to scaffold any database tables at this point (I just call into a separate database and didn't need to)</li><li>Setup the rules in the url manager in your config so that they redirect the incoming /api/model/action into the relevant controller:<br /><blockquote class="tr_bq">'urlManager'=&gt;array(<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; 'urlFormat'=&gt;'path',<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; 'rules'=&gt;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; array('user/get', 'pattern'=&gt;'api/user', 'verb'=&gt;'GET,POST'&nbsp;&nbsp; ),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; array('userdata/get', 'pattern'=&gt;'api/userdata', 'verb'=&gt;'GET,POST'),<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ),<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ),</blockquote></li><li>Remove any other default routes that you do not need from here (such as the post/posts routes)</li><li>Note, I am not using the action in the url, it is implied because I have a very simple REST service that only "GET"s. </li><li>The routes above will automatically redirect to User<b>Controller</b>::get<b>Action</b> and UserData<b>Controller</b>::get<b>Action</b> the bits in bold are added by the framework when resolving the request (btw this is standard Yii behaviour). Note you can also restrict which HTTP verbs are allowed. If you call the route with an incorrect verb you will get a "no route found" error. In my case I allow GET and POST but I will return a specific error if the user tries to use GET.</li><li>Add a relevant method to your controller classes:<br /><blockquote class="tr_bq">public function actionGet()<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( Yii::app()-&gt;request-&gt;requestType != "POST")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $this-&gt;_sendResponse(400, CJSON::encode("Invalid verb. Method requires POST"));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Yii::app()-&gt;end();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />// etc....</blockquote></li><li>Since this is a REST API, it is almost certain that you will be returning JSON encoded data, including with the errors. Note the helper functions for these are defined in the longer tutorial linked above and are added to components\Controller.php (the base class for controllers)</li><li>Remove any default functionality that you don't want/need like login pages and contact forms. </li><li>Optionally redirect/customise standard errors and modify the url manager to not include index.php in the url if required.</li><li>That's it! </li></ol><br /><br />