---
layout: post
title: GMail relay stopped working on Azure Site
date: '2013-06-24T03:59:00.001-07:00'
author: Luke Briner
tags:
- '587'
- Azure
- ssl
- gmail
- mail relay
- '465'
- smtp
- tls
modified_time: '2013-06-24T04:00:05.711-07:00'
---

I had a bit of a mare after starting work Monday morning and seeing several error messages from my Azure-hosted ASP site like this:<br /><br /><span style="-webkit-text-stroke-width: 0px; background-color: white; color: #222222; display: inline !important; float: none; font-family: arial, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;">System.Net.Mail.SmtpException: <b>The SMTP server requires a secure connection or the client was not authenticated. The server response was: 5.5.1 Authentication Required</b>. Learn more at</span><br /><span style="-webkit-text-stroke-width: 0px; background-color: white; color: #222222; display: inline !important; float: none; font-family: arial, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;">&nbsp; &nbsp;at System.Net.Mail.MailCommand.</span><wbr style="-webkit-text-stroke-width: 0px; background-color: white; color: #222222; font-family: arial, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;"></wbr><span style="-webkit-text-stroke-width: 0px; background-color: white; color: #222222; display: inline !important; float: none; font-family: arial, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;">CheckResponse(SmtpStatusCode statusCode, String response)</span><br /><span style="-webkit-text-stroke-width: 0px; background-color: white; color: #222222; display: inline !important; float: none; font-family: arial, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;">&nbsp; &nbsp;at System.Net.Mail.SmtpTransport.</span><br /><wbr style="-webkit-text-stroke-width: 0px; background-color: white; color: #222222; font-family: arial, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;"></wbr><span style="-webkit-text-stroke-width: 0px; background-color: white; color: #222222; display: inline !important; float: none; font-family: arial, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;">SendMail(MailAddress sender, MailAddressCollection recipients, String deliveryNotify, Boolean allowUnicode, SmtpFailedRecipientException&amp; exception)</span><br /><span style="-webkit-text-stroke-width: 0px; background-color: white; color: #222222; display: inline !important; float: none; font-family: arial, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;">&nbsp; &nbsp;at System.Net.Mail.SmtpClient.</span><wbr style="-webkit-text-stroke-width: 0px; background-color: white; color: #222222; font-family: arial, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;"></wbr><span style="-webkit-text-stroke-width: 0px; background-color: white; color: #222222; display: inline !important; float: none; font-family: arial, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;">Send(MailMessage message)</span><br /><span style="-webkit-text-stroke-width: 0px; background-color: white; color: #222222; display: inline !important; float: none; font-family: arial, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;">&nbsp; &nbsp;at ...</span><br /><br /><span style="font-family: inherit;"><span style="font-size: small;"><span style="background-color: white; color: #222222; display: inline ! important; float: none; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px;">The thing that was annoying was that no updates had been made to the site for probably at least a week and certainly nothing in the email sending code for a couple of months. Of course, being on Azure meant it would not be easy to debug or fix.</span></span></span><br /><br /><span style="font-family: inherit;"><span style="font-size: small;"><span style="background-color: white; color: #222222; display: inline ! important; float: none; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px;">Firstly, I tried to change the gmail port</span><span style="background-color: white; color: #222222; display: inline ! important; float: none; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px;"></span>to 465 from 587, apparently 587 (which I was using) is strictly for IMAP and 465 for SMTP. It also appears that one is SSL and the other TLS which is confusing since TLS is the replacement for SSL so I don't know whether this is something historical. Anyway, it didn't work.</span></span><br /><br />What I then did was to use Azure role configuration for the various gmail settings since changing the hard-coded values and updating was being too slow. After doing this, it all appeared to start working again but with the original values that were causing the error.<br /><br />Basically, something was happening/had happened somewhere between Azure and GMail and this had broken my site. Since I use emails for account validation, as many sites do, this was a big deal for me since it means people could not sign up.<br /><br />The thing I despise the most about the net is that we are still largely unable to work out what happens at network level, what part of the internet is slowing us down, where things are broken etc. How many times do you have to call and complain to your service providers who may or may not be at fault? The Azure site monitoring thing is OK but when I had problems with the mail, the site was locked up but the monitoring said the site was running fine so I don't have a lot of trust.<br /><br />Anyway, I wrote this so other's might realise that you haven't done anything wrong!