---
layout: post
title: Adding webHttpBinding to WCF service
date: '2012-12-14T10:15:00.000-08:00'
author: Luke Briner
tags:
- services
- rest
- restful service
- WCF
- webhttpbinding
modified_time: '2012-12-14T10:15:50.070-08:00'
---

For some reason, I felt the need to create a JSON web service for my application. All nice and open-format and compatible but I eventually reached the limits of what I needed to do and decided to go WCF so I could produce a SOAP based web service. This is all great but I still need to be able to call one of the methods directly from a GET request in an image tag (to retrieve the image). This all worked fine under asmx/JSON, I simply wrote the image directly to the response. However, I learned that I needed to use a webHttpBinding in order to provide this functionality and had such a ball-ache getting it to work, partly because I am a bit out of touch with WCF services and had never used webHttpBinding.<br />Anyway, a few scratched heads later (well one head scratched lots) and lots of trial and error and Google searching, I managed to get it to work. Please note that since this is a product of trial-and-error, this is probably not the minimal solution but you should get the idea.<br /><ol><li>Create a WCF in the usual way to product an SVC, an SVC.cs and a web config.</li><li>You need to decorate the services with attributes in the standard way (which should be done by default). This includes OperationContract, ServiceContract and ServiceBehaviour</li><li>For some reason which I don't understand, if you have methods that take more than one parameter, they must be passed in the get request rather than the body and if you don't do this, you will get an error when you try and display the service in the web browser (the easiest way to basically check it is correct). You can handle this by adding the WebGet or WebInvoke (nice Restful attributes!) and then specifying BodyStyle=WebMessageBodyStyle.Wrapped in the constructor.</li><li>You need to have a WebGet or WebInvoke attribute on any method you wish to call via the webHttpBinding and these need to specify how to interpret the request and map onto the method. For instance, I have something like this: [WebGet(UriTemplate="GetImage?userid={userId}&amp;tag={tag}&amp;height={height}&amp;width={width}")] which as you will notice is basically a URL with a query string. The names in the curly brackets map to the names of the method parameters. </li><li>You then need to sort out the config. You can right-click the web config and select Edit WCF Configuration or you can do it manually. I have mixed feelings but the configuration forms do an amount of error checking for you. The config I have that works is shown below:</li></ol><pre style="background-color: #eeeeee; border: 1px dashed #999999; color: black; font-family: Andale Mono, Lucida Console, Monaco, fixed, monospace; font-size: 12px; line-height: 14px; overflow: auto; padding: 5px; width: 100%;"><code>&lt;system.serviceModel&gt;<br />    &lt;bindings&gt;<br />      &lt;wsHttpBinding&gt;<br />        &lt;binding name="standardConfig" maxReceivedMessageSize="65536000"&gt;<br />          &lt;readerQuotas maxDepth="32"<br />                        maxStringContentLength="65536000"<br />                        maxArrayLength="65536000"<br />                        maxBytesPerRead="65536000"<br />                        maxNameTableCharCount="65536000" /&gt;<br />        &lt;/binding&gt;<br />      &lt;/wsHttpBinding&gt;<br />      &lt;webHttpBinding&gt;<br />        &lt;binding name="basicConfig" /&gt;<br />      &lt;/webHttpBinding&gt;<br />    &lt;/bindings&gt;<br />    &lt;behaviors&gt;<br />      &lt;endpointBehaviors&gt;<br />        &lt;behavior name="WebBehaviour"&gt;<br />          &lt;webHttp /&gt;<br />        &lt;/behavior&gt;<br />      &lt;/endpointBehaviors&gt;<br />      &lt;serviceBehaviors&gt;<br />        &lt;behavior name=""&gt;<br />          &lt;serviceMetadata httpGetEnabled="true" httpsGetEnabled="true" /&gt;<br />          &lt;serviceDebug includeExceptionDetailInFaults="true" /&gt;<br />        &lt;/behavior&gt;<br />      &lt;/serviceBehaviors&gt;<br />    &lt;/behaviors&gt;<br />    &lt;serviceHostingEnvironment aspNetCompatibilityEnabled="true" multipleSiteBindingsEnabled="true" /&gt;<br />    &lt;services&gt;<br />      &lt;service name="FullNamespace.ServiceImplementation"&gt;<br />        &lt;endpoint address="web" behaviorConfiguration="WebBehaviour" binding="webHttpBinding" bindingConfiguration="basicConfig" name="web" bindingNamespace="</code><code><code></code><code><code></code><code><code><code>FullNamespaceUri</code></code></code></code>" contract="</code><code><code>FullNamespace.ServiceInterface</code>" /&gt;<br />        &lt;endpoint address="standard" binding="wsHttpBinding" bindingConfiguration="standardConfig" name="standard" bindingName="standard" contract="FullNamespace.ServiceInterface"  bindingNamespace="</code><code><code></code><code><code></code><code><code><code>FullNamespaceUri</code></code></code></code>" /&gt;<br />      &lt;/service&gt;<br />      &lt;service name="</code><code><code>FullNamespace.OtherImplementation</code>"&gt;<br />        &lt;endpoint address="web" behaviorConfiguration="WebBehaviour" binding="webHttpBinding" bindingConfiguration="basicConfig" name="web" bindingNamespace="</code><code><code></code><code><code></code><code><code><code>FullNamespaceUri</code></code></code></code>" contract="</code><code><code><code>FullNamespace</code>.OtherServiceInterface</code>" /&gt;<br />        &lt;endpoint address="standard" binding="wsHttpBinding" bindingConfiguration="standardConfig" name="standard" bindingName="standard" contract="</code><code><code>FullNamespace</code>.OtherServiceInterface"  bindingNamespace="</code><code><code></code><code><code><code>FullNamespaceUri</code></code></code>" /&gt;<br />      &lt;/service&gt;<br />    &lt;/services&gt;<br />  &lt;/system.serviceModel&gt;<br /></code></pre>Note that since webHttpBinding does not use SOAP, you will not be able to get an ASP.Net service reference to create a client binding for it but you should be able to access the method directly from a browser.<br />You might get all kinds of errors if you change what is written here so I suggest trying to start from what I've specified and get that working and then modifying it stage by stage to match what you want to do. You should then be able to work out what is happening.<br />In the case of the code above, I can access the service by http://localhost/ServiceName.svc/web/GetImage?userid=.... 