---
layout: post
title: 'Publish-AzureServiceProject : The remote server returned an error: (500) Internal
  Server Error'
date: '2013-07-16T03:04:00.001-07:00'
author: Luke Briner
tags:
- Internal Server Error
- Azure
- Error
- Publish-AzureServiceProject
- PHP Azure
- Powershell
- errors
- StorageException
- Timeout
modified_time: '2013-09-05T04:24:20.310-07:00'
---

I had moved offices and started getting this error every time I tried to deploy a PHP cloud service directly using the Powershell Scripts. It took me a whole morning to fix but using Fiddler, I noticed that there was a timeout occurring during upload. This timeout is not reported directly by the script but it retries and when it ultimately fails, you get an error like this:<br /><br /><span style="-webkit-text-stroke-width: 0px; background-color: white; color: #666666; display: inline !important; float: none; font-family: 'Segoe UI', Helvetica, Garuda, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;">PS C:\projects\fws2&gt; Publish-AzureServiceProject</span><br /><span style="-webkit-text-stroke-width: 0px; background-color: white; color: #666666; display: inline !important; float: none; font-family: 'Segoe UI', Helvetica, Garuda, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;">VERBOSE: Publishing&nbsp; to Windows Azure. This may take several minutes...</span><br /><span style="-webkit-text-stroke-width: 0px; background-color: white; color: #666666; display: inline !important; float: none; font-family: 'Segoe UI', Helvetica, Garuda, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;">VERBOSE: 02:15:02 - Preparing runtime deployment for service 'fws2'</span><br /><span style="-webkit-text-stroke-width: 0px; background-color: white; color: #666666; display: inline !important; float: none; font-family: 'Segoe UI', Helvetica, Garuda, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;">VERBOSE: 02:15:02 - Preparing deployment for socket with Subscription ID:</span><br /><span style="-webkit-text-stroke-width: 0px; background-color: white; color: #666666; display: inline !important; float: none; font-family: 'Segoe UI', Helvetica, Garuda, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;">GUID...</span><br /><span style="-webkit-text-stroke-width: 0px; background-color: white; color: #666666; display: inline !important; float: none; font-family: 'Segoe UI', Helvetica, Garuda, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;">VERBOSE: 02:15:25 - Connecting...</span><br /><span style="-webkit-text-stroke-width: 0px; background-color: white; color: #666666; display: inline !important; float: none; font-family: 'Segoe UI', Helvetica, Garuda, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;">VERBOSE: 02:15:33 - Uploading Package to storage service xxx...</span><br /><span style="-webkit-text-stroke-width: 0px; background-color: white; color: #666666; display: inline !important; float: none; font-family: 'Segoe UI', Helvetica, Garuda, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;"><b>Publish-AzureServiceProject : The remote server returned an error: (500) Internal Server Error</b>.</span><br /><span style="-webkit-text-stroke-width: 0px; background-color: white; color: #666666; display: inline !important; float: none; font-family: 'Segoe UI', Helvetica, Garuda, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;">At line:1 char:1</span><br /><span style="-webkit-text-stroke-width: 0px; background-color: white; color: #666666; display: inline !important; float: none; font-family: 'Segoe UI', Helvetica, Garuda, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;">+ Publish-AzureServiceProject</span><br /><span style="-webkit-text-stroke-width: 0px; background-color: white; color: #666666; display: inline !important; float: none; font-family: 'Segoe UI', Helvetica, Garuda, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;">+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br /><b><span style="-webkit-text-stroke-width: 0px; background-color: white; color: #666666; display: inline !important; float: none; font-family: 'Segoe UI', Helvetica, Garuda, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;">&nbsp;&nbsp;&nbsp; + <b>CategoryInfo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : CloseError: (:) [Publish-AzureServiceProject], StorageException</b></span></b><br /><span style="-webkit-text-stroke-width: 0px; background-color: white; color: #666666; display: inline !important; float: none; font-family: 'Segoe UI', Helvetica, Garuda, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;">&nbsp;&nbsp;&nbsp; + FullyQualifiedErrorId : Microsoft.WindowsAzure.Management.CloudService.Cmdlet.PublishAzureServiceProjectCommand</span><br /><br />I don't know if/how you could adjust the timeout or get it to report a much more useful error to the user. This happened because our new office has much slower upload speed than the old office and the timeout is only 90 seconds.<br /><br />The <b>workaround</b> is not to use the Powershell script Publish-AzureServiceProject but to manually update the deployment from the Azure management portal by browsing to the local cloud_package.cspkg and ServiceConfiguration.Cloud.cscfg files. For reference, Visual Studio uses chunk uploading to get around the timeout problem and since the flag "-PackageOnly" is not yet available on the Publish-AzureServiceProject script, I usually run the script, wait for it to timeout and then upload the package it just created!